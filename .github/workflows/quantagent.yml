name: QuantAgent

on:
  # æ‰‹åŠ¨è§¦å‘
  workflow_dispatch:
    inputs:
      mode:
        description: 'è¿è¡Œæ¨¡å¼'
        required: false
        default: 'stocks-only'
        type: choice
        options:
          - full          # å®Œæ•´åˆ†æï¼ˆè‚¡ç¥¨+å¤§ç›˜ï¼‰
          - market-only   # ä»…å¤§ç›˜å¤ç›˜
          - stocks-only   # ä»…è‚¡ç¥¨åˆ†æ

# å¹¶å‘æ§åˆ¶ï¼šåŒä¸€æ—¶é—´åªè¿è¡Œä¸€ä¸ªåˆ†æä»»åŠ¡
concurrency:
  group: stock-analysis
  cancel-in-progress: false

jobs:
  analyze:
    runs-on: ubuntu-latest
    # æ·»åŠ è¶…æ—¶é™åˆ¶ï¼Œé˜²æ­¢ä»»åŠ¡å¡æ­»
    timeout-minutes: 30
    
    steps:
      - name: set beijing timezone
        uses: szenius/set-timezone@v2.0 # è®¾ç½®è™šæ‹Ÿç¯å¢ƒçš„æ—¶åŒºï¼Œå¯æ›´æ”¹æ—¶åŒº
        with:
          timezoneLinux: "Asia/Shanghai"
      - name: æ£€å‡ºä»£ç 
        uses: actions/checkout@v4
        with:
          ref: master  # æ˜ç¡®æŒ‡å®šä½¿ç”¨masteråˆ†æ”¯
          fetch-depth: 1  # åªæ‹‰å–æœ€æ–°æäº¤ï¼ŒåŠ å¿«é€Ÿåº¦
      
      - name: è®¾ç½® Python ç¯å¢ƒ
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'
          cache: 'pip'
      
      - name: å®‰è£…ä¾èµ–
        run: |
          pip install --upgrade pip
          pip install -r requirements.txt
      
      - name: åˆ›å»ºå¿…è¦ç›®å½•
        run: |
          mkdir -p data logs reports
      
      - name: æ‰§è¡Œè‚¡ç¥¨åˆ†æ
        env:
          # ==========================================
          # AI é…ç½®
          # ==========================================
          # Gemini AIï¼ˆä¸»é€‰ï¼‰
          AGENT_API_KEY: ${{ secrets.GH_API_KEY }}
          AGENT_LLM_PROVIDER: 'openai'
          AGENT_LLM_MODEL: 'openai/gpt-4.1'
          AGENT_LLM_TEMPERATURE: 0.0
          AGENT_LLM_BASE_URL: 'https://models.github.ai/inference'
          GRAPH_LLM_PROVIDER: 'openai'
          GRAPH_LLM_MODEL: 'openai/gpt-4.1'
          GRAPH_LLM_TEMPERATURE: 0.0
          GRAPH_LLM_BASE_URL: 'https://models.github.ai/inference'
          GRAPH_API_KEY: ${{ secrets.GH_API_KEY }}
          # AGENT_API_KEY: "89652169c1754f468131df6a9affa521.vCmjdXJWImY7OjLH,7d14b4c07a49473785766fa69b6feed1.OXZ2ZlvfKLzO4lla,fab8db5f2bb045ebb1ca18d315b8b222.tRjEGGexVNM4Otv9,62b2f2da2d014b45bbf55c1fb25eb939.fAAQPfBxSng1BX9v"
          # AGENT_LLM_PROVIDER: 'openai'
          # AGENT_LLM_MODEL: 'glm-z1-air'
          # AGENT_LLM_TEMPERATURE: 0.0
          # AGENT_LLM_BASE_URL: 'https://open.bigmodel.cn/api/paas/v4'
          # GRAPH_LLM_PROVIDER: 'openai'
          # GRAPH_LLM_MODEL: 'glm-4.6V-flash'
          # GRAPH_LLM_TEMPERATURE: 0.0
          # GRAPH_LLM_BASE_URL: 'https://open.bigmodel.cn/api/paas/v4'
          # GRAPH_API_KEY: "89652169c1754f468131df6a9affa521.vCmjdXJWImY7OjLH,7d14b4c07a49473785766fa69b6feed1.OXZ2ZlvfKLzO4lla,fab8db5f2bb045ebb1ca18d315b8b222.tRjEGGexVNM4Otv9,62b2f2da2d014b45bbf55c1fb25eb939.fAAQPfBxSng1BX9v"
          
          
        run: |
          echo "=========================================="
          echo "ğŸš€ Aè‚¡è‡ªé€‰è‚¡æ™ºèƒ½åˆ†æç³»ç»Ÿ"
          echo "=========================================="
          echo "â° æ—¶é—´: $(TZ='Asia/Shanghai' date '+%Y-%m-%d %H:%M:%S')"
          echo "ğŸ¯ è¿è¡Œæ¨¡å¼: $MODE"
          echo "ğŸ“Š è‡ªé€‰è‚¡: $STOCK_LIST"
          echo "ğŸ“ æŠ¥å‘Šç±»å‹: $REPORT_TYPE"
          echo ""
          echo "=========================================="
          echo "ğŸ“‹ é…ç½®æ£€æŸ¥"
          echo "=========================================="
          echo "ã€AI é…ç½®ã€‘"
          echo "  API Key: $([ -n "$API_KEY" ] && echo 'âœ… å·²é…ç½®' || echo 'âŒ æœªé…ç½®')"
          echo "=========================================="
          echo ""

          python main.py
      
